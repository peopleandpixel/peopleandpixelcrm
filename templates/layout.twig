<!doctype html>
<html lang="{{ currentLang|default('en')|e }}" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ __('People & Pixel - Basic CRM')|e }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="canonical" href="{{ canonical_url() }}">
    <!-- Tailwind CSS + DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <!-- Custom overrides (optional) -->
    <link rel="stylesheet" href="{{ url('/style.css') }}">
</head>
<body class="min-h-screen bg-base-100 text-base-content">
{% include 'partials/header.twig' %}
<div id="main" class="container mx-auto p-4" tabindex="-1">
    {% include 'partials/flashes.twig' %}
    <div class="flex gap-4">
        <aside class="w-56 shrink-0">
            <ul class="menu bg-base-200 rounded-box">
                <li><a href="{{ url('/') }}" class="{{ active_class('/') ? 'active' : '' }}" {{ active_class('/') ? 'aria-current="page"' : '' }}>{{ __('Home')|e }}</a></li>
                <li><a href="{{ url('/contacts') }}" class="{{ active_class('/contacts') ? 'active' : '' }}" {{ active_class('/contacts') ? 'aria-current="page"' : '' }}>{{ __('Contacts')|e }}</a></li>
                <li><a href="{{ url('/tasks') }}" class="{{ active_class('/tasks') ? 'active' : '' }}" {{ active_class('/tasks') ? 'aria-current="page"' : '' }}>{{ __('Tasks')|e }}</a></li>
                <li><a href="{{ url('/employees') }}" class="{{ active_class('/employees') ? 'active' : '' }}" {{ active_class('/employees') ? 'aria-current="page"' : '' }}>{{ __('Employees')|e }}</a></li>
                <li><a href="{{ url('/times') }}" class="{{ active_class('/times') ? 'active' : '' }}" {{ active_class('/times') ? 'aria-current="page"' : '' }}>{{ __('Working Times')|e }}</a></li>
                <li><a href="{{ url('/candidates') }}" class="{{ active_class('/candidates') ? 'active' : '' }}" {{ active_class('/candidates') ? 'aria-current="page"' : '' }}>{{ __('Recruiting')|e }}</a></li>
                <li><a href="{{ url('/payments') }}" class="{{ active_class('/payments') ? 'active' : '' }}" {{ active_class('/payments') ? 'aria-current="page"' : '' }}>{{ __('Payments')|e }}</a></li>
                <li><a href="{{ url('/storage') }}" class="{{ active_class('/storage') ? 'active' : '' }}" {{ active_class('/storage') ? 'aria-current="page"' : '' }}>{{ __('Storage')|e }}</a></li>
                {% if is_admin() %}
                <li><a href="{{ url('/admin/users') }}" class="{{ active_class('/admin') ? 'active' : '' }}" {{ active_class('/admin') ? 'aria-current="page"' : '' }}>{{ __('Users')|e }}</a></li>
                {% endif %}
                <li class="mt-2 px-4 pb-3">
                    <label class="label" for="lang-select"><span class="label-text">{{ __('Language')|e }}</span></label>
                    <select id="lang-select" class="select select-bordered w-full max-w-xs" aria-label="{{ __('Language')|e }}">
                        {% set cl = currentLang|default('en') %}
                        <option value="en" {{ cl=='en' ? 'selected' : '' }}>EN</option>
                        <option value="de" {{ cl=='de' ? 'selected' : '' }}>DE</option>
                        <option value="pt" {{ cl=='pt' ? 'selected' : '' }}>PT</option>
                    </select>
                </li>
            </ul>
        </aside>
        <main class="flex-1">
            {% block content %}{% endblock %}
        </main>
    </div>
</div>
{% include 'partials/footer.twig' %}
<script>
(function(){
  // Language selector change handler
  const sel = document.getElementById('lang-select');
  if (sel){
    sel.addEventListener('change', function(){
      const value = this.value;
      try {
        const url = new URL(window.location.href);
        url.searchParams.set('lang', value);
        window.location.href = url.toString();
      } catch (e) {
        const loc = window.location;
        const query = loc.search ? loc.search.substring(1) : '';
        const params = new URLSearchParams(query);
        params.set('lang', value);
        const q = params.toString();
        window.location.href = loc.pathname + (q ? ('?' + q) : '');
      }
    });
  }

  // THEME: apply saved or preferred theme on load using DaisyUI data-theme
  const storageKey = 'pp.theme';
  const btn = document.getElementById('theme-toggle');
  function getStoredTheme(){
    try { return localStorage.getItem(storageKey); } catch(e){ return null; }
  }
  function storeTheme(t){ try { localStorage.setItem(storageKey, t); } catch(e){} }
  function systemPrefersDark(){
    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  }
  function applyTheme(theme){
    const t = theme || 'light';
    document.documentElement.setAttribute('data-theme', t);
    document.body.setAttribute('data-theme', t);
    if (btn){
      btn.setAttribute('aria-pressed', t === 'dark' ? 'true' : 'false');
      const icon = btn.querySelector('[data-icon]');
      if (icon){ icon.textContent = (t === 'dark') ? 'üåô' : '‚òÄÔ∏è'; }
    }
  }
  let initial = getStoredTheme();
  if (!initial) { initial = systemPrefersDark() ? 'dark' : 'light'; }
  applyTheme(initial);
  if (btn){
    btn.addEventListener('click', function(ev){
      ev.preventDefault();
      const cur = document.documentElement.getAttribute('data-theme') || 'light';
      const next = (cur === 'dark') ? 'light' : 'dark';
      applyTheme(next);
      storeTheme(next);
      try {
        const live = document.getElementById('sr-live');
        if (live) live.textContent = (next === 'dark') ? 'Dark theme enabled' : 'Light theme enabled';
      } catch(e){}
    });
  }
  if (!getStoredTheme() && window.matchMedia) {
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    if (mq.addEventListener) mq.addEventListener('change', function(e){ applyTheme(e.matches ? 'dark' : 'light'); });
    else if (mq.addListener) mq.addListener(function(e){ applyTheme(e.matches ? 'dark' : 'light'); });
  }
})();
</script>
</body>
</html>
