<section>
    <h2>{{ title|default('')|e }}</h2>
    <form method="post" class="form"{% if form_action is defined and form_action %} action="{{ form_action }}"{% endif %}>
        {{ csrf_field()|raw }}
        {% if task is defined and task.id is defined and task.id %}
            <input type="hidden" name="id" value="{{ (task.id)|int }}">
        {% endif %}
        <div class="form-row">
            <label for="contact_id">{{ __('Contact')|e }}</label>
            <select id="contact_id" name="contact_id">
                <option value="0">{{ __('Unassigned')|e }}</option>
                {% for c in contacts|default([]) %}
                    {% set selId = contactId is defined ? (contactId|int) : (task.contact_id|default(0)) %}
                    <option value="{{ (c.id|default(0))|int }}" {{ selId == (c.id|default(0)) ? 'selected' : '' }}>
                        {{ (c.name|default(''))|e }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-row">
            <label for="title">{{ __('Title')|e }} *</label>
            <input type="text" id="title" name="title" value="{{ title|default(task.title|default(''))|e }}" required>
        </div>
        <div class="form-row">
            <label for="due_date">{{ __('Due date')|e }}</label>
            <input type="date" id="due_date" name="due_date" value="{{ due_date|default(task.due_date|default(''))|e }}">
        </div>
        <div class="form-row">
            <label for="status">{{ __('Status')|e }}</label>
            {% set curStatus = status|default(task.status|default('open')) %}
            <select id="status" name="status">
                <option value="open" {{ curStatus == 'open' ? 'selected' : '' }}>{{ __('Open')|e }}</option>
                <option value="done" {{ curStatus == 'done' ? 'selected' : '' }}>{{ __('Done')|e }}</option>
            </select>
        </div>
        {% if task is defined and task.done_date is defined and task.done_date %}
            <div class="form-row">
                <label>{{ __('Done date')|e }}</label>
                <input type="date" value="{{ task.done_date|e }}" disabled>
            </div>
        {% endif %}
        <div class="form-row">
            <label for="notes">{{ __('Notes')|e }}</label>
            <textarea id="notes" name="notes" rows="3">{{ notes|default(task.notes|default(''))|e }}</textarea>
        </div>
        <div class="form-actions">
            <a class="btn btn-secondary" href="{{ url('/tasks') }}">{{ __('Cancel')|e }}</a>
            <button class="btn" type="submit">{{ submit_label|default(__('Save Task')|e) }}</button>
        </div>
    </form>
</section>
