{% extends 'layout.twig' %}
{% block content %}
<section class="space-y-4">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <h2 class="text-2xl font-bold">{{ title|e }}</h2>
    <div class="flex items-center gap-2">
      <a class="btn" href="{{ url('/reports') }}">{{ __('Back')|e }}</a>
      <a class="btn" href="{{ url('/reports/export.csv', { name: def.name|default('report'), entity: def.entity, group_by: def.group_by, metric: def.metric, period: def.period|default('month'), from: def.filters.from|default(''), to: def.filters.to|default(''), status: def.filters.status|default(''), owner_id: def.filters.owner_id|default(''), tag: def.filters.tag|default('') }) }}">CSV</a>
    </div>
  </div>

  {% if def is defined %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    <div class="card bg-base-100 p-3 shadow">
      <div class="font-semibold">{{ __('Definition')|e }}</div>
      <div class="text-sm opacity-80">
        <div>{{ __('Entity')|e }}: {{ def.entity|e }}</div>
        <div>{{ __('Group by')|e }}: {{ def.group_by|e }}</div>
        <div>{{ __('Metric')|e }}: {{ def.metric|e }}</div>
        <div>{{ __('Period')|e }}: {{ def.period|default('month')|e }}</div>
      </div>
    </div>
    <div class="card bg-base-100 p-3 shadow">
      <div class="font-semibold">{{ __('Filters')|e }}</div>
      <div class="text-sm opacity-80">
        {% if def.filters is defined and def.filters %}
          {% for k,v in def.filters %}
            <div>{{ k|e }}: {{ v|e }}</div>
          {% endfor %}
        {% else %}
          <div>{{ __('None')|e }}</div>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  <div class="overflow-x-auto">
    <table class="table table-zebra w-full">
      <thead>
        <tr>
          <th>{{ __('Label')|e }}</th>
          <th>{{ __('Value')|e }}</th>
          <th>{{ __('Count')|e }}</th>
        </tr>
      </thead>
      <tbody>
        {% for r in report.rows %}
        <tr>
          <td>{{ r.label|e }}</td>
          <td>{{ r.value }}</td>
          <td>{{ r.count }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
